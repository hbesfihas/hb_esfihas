{% extends 'base.html' %}
{% load static %}
{% block title %}Card√°pio | HB Esfihas{% endblock %}

{% block content %}
<h2 class="text-center mb-4">üçΩÔ∏è Card√°pio</h2>
<div class="accordion" id="accordionCategorias">
    {% for categoria in categorias %}
    <div class="accordion-item mb-3 border-0 shadow-sm">
        <h2 class="accordion-header" id="heading-{{ categoria.id }}">
            <button class="accordion-button collapsed accordion-button-custom" type="button" data-bs-toggle="collapse"
                data-bs-target="#collapse-{{ categoria.id }}" style="background-color: {{ categoria.cor }};">

                {% if categoria.icone_bootstrap %}
                <i class="{{ categoria.icone_bootstrap }} me-2 fs-5"></i>
                {% else %}
                <i class="bi bi-tag-fill me-2 fs-5"></i>
                {% endif %}

                <strong>{{ categoria.nome }}</strong>
            </button>
        </h2>
        <div id="collapse-{{ categoria.id }}" class="accordion-collapse collapse" data-bs-parent="#accordionCategorias">
            <div class="accordion-body">
                <div class="row">

                    {% for produto in categoria.produto_set.all %}
                    {% if produto.disponivel %}
                    <div class="col-12 col-md-6 col-lg-4 d-flex align-items-stretch justify-content-center mb-4">
                        <div class="product-card text-center {% if produto.estoque <= 0 %}esgotado{% endif %}"
                            data-id="{{ produto.id }}" data-nome="{{ produto.nome }}"
                            data-preco="{{ produto.preco|floatformat:2 }}">

                            {% if produto.imagem %}
                            <img src="{{ produto.imagem.url }}" alt="{{ produto.nome }}" class="product-img mb-2">
                            {% else %}
                            <img src="{% static 'img/imagem_padrao.jpg' %}" alt="Imagem Padr√£o"
                                class="product-img mb-2">
                            {% endif %}

                            <div class="product-name">{{ produto.nome }}</div>
                            <div class="product-description">{{ produto.descricao }}</div>
                            <div class="product-price">R$ {{ produto.preco|floatformat:2 }}</div>

                            <div id="controls-{{ produto.id }}" class="mt-2" data-estoque="{{ produto.estoque }}">
                            </div>

                            {% if produto.estoque > 0 and produto.estoque <= 5 %} <div
                                class="badge bg-warning text-dark mt-2">√öltimas {{ produto.estoque }} unidades!
                        </div>
                        {% endif %}
                    </div>
                </div>
                {% endif %}
                {% endfor %}
            </div>
        </div>
    </div>
</div>
{% endfor %}
</div>


<div class="mt-5 card p-3" id="sacolaResumo">
    <h4 class="mb-3">üõçÔ∏è Sacola</h4>
    <ul id="listaSacola" class="list-group mb-3"></ul>
    <h5>Total: R$ <span id="totalSacola">0.00</span></h5>
{% if configuracao_loja.loja_aberta %}
    <button id="btn-finalizar-pedido" class="btn btn-primary mt-2">Finalizar Pedido</button>
{% else %}
    <button class="btn btn-danger mt-2" disabled>Loja Fechada no Momento</button>
{% endif %}
</div>

<script src="{% static 'js/gerenciador-sacola.js' %}"></script>
{% endblock %}