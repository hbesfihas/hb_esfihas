{% extends 'base.html' %}
{% block title %}Entrega ou Retirada{% endblock %}

{% block content %}
<h3 class="mb-3 text-center">Como deseja receber seu pedido?</h3>

<form method="post" onsubmit="coletarLocalizacao()">
  {% csrf_token %}
  <div class="mb-3">
    <label><input type="radio" name="modo_entrega" value="entrega" required> Entrega</label><br>
    <label><input type="radio" name="modo_entrega" value="retirada"> Vou buscar</label><br>
    <label><input type="radio" name="modo_entrega" value="local"> Consumir no local</label>
  </div>

  <div id="campoEndereco" class="mb-3 d-none">
    <label for="endereco">Endere√ßo para entrega:</label>
    <input type="text" class="form-control" name="endereco" id="endereco">
    <input type="hidden" name="latitude" id="latitude">
    <input type="hidden" name="longitude" id="longitude">
    <button type="button" class="btn btn-sm btn-secondary mt-2" onclick="obterLocalizacao()">üìç Usar minha localiza√ß√£o</button>
  </div>

  <button type="submit" class="btn btn-primary mt-3">Continuar</button>
</form>

<script>
document.querySelectorAll('input[name="modo_entrega"]').forEach(radio => {
  radio.addEventListener('change', () => {
    const campoEndereco = document.getElementById('campoEndereco');
    if (radio.value === 'entrega') {
      campoEndereco.classList.remove('d-none');
    } else {
      campoEndereco.classList.add('d-none');
    }
  });
});

function obterLocalizacao() {
  if (navigator.geolocation) {
    navigator.geolocation.getCurrentPosition(pos => {
      document.getElementById('latitude').value = pos.coords.latitude;
      document.getElementById('longitude').value = pos.coords.longitude;
    }, err => {
      alert("Erro ao obter localiza√ß√£o: " + err.message);
    });
  } else {
    alert("Seu navegador n√£o suporta localiza√ß√£o.");
  }
}

function coletarLocalizacao() {
  const modo = document.querySelector('input[name="modo_entrega"]:checked')?.value;
  if (modo === 'entrega') {
    obterLocalizacao();
  }
}
</script>
{% endblock %}
